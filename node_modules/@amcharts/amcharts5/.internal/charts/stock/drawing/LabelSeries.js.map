{"version":3,"file":"LabelSeries.js","sourceRoot":"","sources":["../../../../../../src/.internal/charts/stock/drawing/LabelSeries.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ISpritePointerEvent } from \"../../../core/render/Sprite\";\r\nimport type { Container } from \"../../../core/render/Container\";\r\nimport type { DataItem } from \"../../../core/render/Component\";\r\nimport type { SpriteResizer } from \"../../../core/render/SpriteResizer\";\r\nimport type { Graphics } from \"../../../core/render/Graphics\";\r\nimport type { IDrawingSeriesDataItem } from \"./DrawingSeries\";\r\n\r\nimport { PolylineSeries, IPolylineSeriesSettings, IPolylineSeriesPrivate, IPolylineSeriesDataItem } from \"./PolylineSeries\";\r\nimport { EditableLabel } from \"../../../core/render/EditableLabel\";\r\nimport type { Color } from \"../../../core/util/Color\";\r\nimport { Template } from \"../../../core/util/Template\";\r\n\r\nimport * as $array from \"../../../core/util/Array\";\r\nimport * as $object from \"../../../core/util/Object\";\r\n\r\nexport interface ILabelSeriesDataItem extends IPolylineSeriesDataItem {\r\n}\r\n\r\nexport interface ILabelSeriesSettings extends IPolylineSeriesSettings {\r\n\r\n\t/**\r\n\t * Label font size.\r\n\t */\r\n\tlabelFontSize?: number | string | undefined;\r\n\r\n\t/**\r\n\t * Label font damily.\r\n\t */\r\n\tlabelFontFamily?: string;\r\n\r\n\t/**\r\n\t * Font weight.\r\n\t */\r\n\tlabelFontWeight?: \"normal\" | \"bold\" | \"bolder\" | \"lighter\" | \"100\" | \"200\" | \"300\" | \"400\" | \"500\" | \"600\" | \"700\" | \"800\" | \"900\";\r\n\r\n\t/**\r\n\t * Font style.\r\n\t */\r\n\tlabelFontStyle?: \"normal\" | \"italic\" | \"oblique\";\r\n\r\n\t/**\r\n\t * Label color.\r\n\t */\r\n\tlabelFill?: Color;\r\n\r\n}\r\n\r\nexport interface ILabelSeriesPrivate extends IPolylineSeriesPrivate {\r\n\tinputContainer: HTMLDivElement;\r\n\tinput: HTMLTextAreaElement;\r\n\tlabel: EditableLabel;\r\n}\r\n\r\nexport class LabelSeries extends PolylineSeries {\r\n\tpublic static className: string = \"LabelSeries\";\r\n\tpublic static classNames: Array<string> = PolylineSeries.classNames.concat([LabelSeries.className]);\r\n\r\n\tdeclare public _settings: ILabelSeriesSettings;\r\n\tdeclare public _privateSettings: ILabelSeriesPrivate;\r\n\tdeclare public _dataItemSettings: ILabelSeriesDataItem;\r\n\r\n\tpublic spriteResizer!: SpriteResizer;\r\n\r\n\tprotected _clickEvent?: ISpritePointerEvent;\r\n\r\n\tprotected _tag = \"label\";\r\n\r\n\tprotected _isEditing: boolean = false;\r\n\r\n\tprotected _isSelected: boolean = false;\r\n\r\n\tprotected _afterNew() {\r\n\t\tsuper._afterNew();\r\n\r\n\t\tthis.spriteResizer = this._getStockChart().spriteResizer;\r\n\r\n\t\tthis.strokes.template.set(\"visible\", false);\r\n\t\tthis.fills.template.set(\"visible\", false);\r\n\r\n\t\tthis.addTag(this._tag);\r\n\t}\r\n\r\n\tprotected _dispatchAdded(): void {\r\n\r\n\t}\r\n\r\n\tprotected _setContextSprite(_context: any) { }\r\n\r\n\tprotected _tweakBullet(container: Container, dataItem: DataItem<ILabelSeriesDataItem>) {\r\n\t\tconst dataContext = dataItem.dataContext as any;\r\n\t\tconst text = dataContext.text;\r\n\t\tconst template = dataContext.settings;\r\n\r\n\t\tif (template) {\r\n\t\t\tconst label = container.children.push(EditableLabel.new(this._root, {\r\n\t\t\t\tthemeTags: [\"label\"],\r\n\t\t\t\ttext: text,\r\n\t\t\t\teditOn: \"none\",\r\n\t\t\t\tactive: true\r\n\t\t\t}, template));\r\n\r\n\t\t\tlabel.on(\"text\", (text)=>{\r\n\t\t\t\tdataContext.text = text;\r\n\t\t\t})\r\n\r\n\t\t\tthis.setPrivate(\"label\", label);\r\n\r\n\t\t\tlabel.on(\"active\", () => {\r\n\t\t\t\tthis.setTimeout(() => {\r\n\t\t\t\t\tthis._isEditing = label.get(\"active\", false);\r\n\t\t\t\t}, 200)\r\n\r\n\t\t\t\tif (!label.get(\"active\")) {\r\n\t\t\t\t\tthis.setTimeout(() => {\r\n\t\t\t\t\t\tif (label) {\r\n\t\t\t\t\t\t\tif (label.get(\"text\") == \"\") {\r\n\t\t\t\t\t\t\t\tthis._disposeIndex(dataContext.index);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 100)\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis._isEditing = true;\r\n\r\n\t\t\tcontainer.events.on(\"click\", (e) => {\r\n\t\t\t\tconst spriteResizer = this.spriteResizer;\r\n\t\t\t\tif (spriteResizer.get(\"sprite\") == label) {\r\n\t\t\t\t\tthis._isEditing = true;\r\n\t\t\t\t\tlabel.set(\"active\", true);\r\n\t\t\t\t\tthis._selectDrawing(dataContext.index, (e.originalEvent as any).ctrlKey, true);\r\n\t\t\t\t\tspriteResizer.set(\"sprite\", undefined);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._isEditing = false;\r\n\t\t\t\t\tthis._isSelected = true;\r\n\t\t\t\t\tspriteResizer.set(\"sprite\", label);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tcontainer.events.on(\"pointerover\", () => {\r\n\t\t\t\tthis._isHover = true;\r\n\t\t\t})\r\n\r\n\t\t\tcontainer.events.on(\"pointerout\", () => {\r\n\t\t\t\tthis._isHover = false;\r\n\t\t\t})\r\n\r\n\t\t\tlabel.on(\"scale\", (scale) => {\r\n\t\t\t\ttemplate.set(\"scale\", scale);\r\n\t\t\t})\r\n\r\n\t\t\tlabel.on(\"rotation\", (rotation) => {\r\n\t\t\t\ttemplate.set(\"rotation\", rotation)\r\n\t\t\t})\r\n\r\n\t\t\tlabel.events.on(\"boundschanged\", () => {\r\n\t\t\t\tthis.markDirty();\r\n\t\t\t})\r\n\r\n\t\t\tdataContext.sprite = container;\r\n\t\t\tdataContext.label = label;\r\n\r\n\t\t\tthis._tweakBullet2(label, dataItem);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _tweakBullet2(_label: EditableLabel, _dataItem: DataItem<ILabelSeriesDataItem>) {\r\n\r\n\t}\r\n\r\n\tprotected _handlePointerClick(event: ISpritePointerEvent) {\r\n\t\tif (this._isEditing) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this._selected.length > 0 || this._isSelected) {\r\n\t\t\tthis._isSelected = false;\r\n\t\t\tthis._hideResizer();\r\n\t\t\tthis.unselectAllDrawings();\r\n\t\t}\r\n\t\telse if (this._drawingEnabled) {\r\n\t\t\tif (!this._isHover) {\r\n\t\t\t\tthis.isDrawing(true);\r\n\t\t\t\tthis._increaseIndex();\r\n\t\t\t\tthis._di[this._index] = {};\r\n\r\n\t\t\t\tthis._addPoint(event);\r\n\t\t\t\tconst dataContext = this.data.getIndex(this.data.length - 1) as any;\r\n\t\t\t\tdataContext.text = \"\";\r\n\t\t\t\tdataContext.index = this._index;\r\n\t\t\t\tdataContext.corner = 0;\r\n\t\t\t\tdataContext.settings = this._getLabelTemplate();\r\n\t\t\t\tthis._afterTextSave(dataContext);\r\n\r\n\t\t\t\tthis.spriteResizer.set(\"sprite\", undefined);\r\n\r\n\t\t\t\tthis._dispatchStockEvent(\"drawingadded\", this._drawingId, this._index);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.isDrawing(false);\r\n\t}\r\n\r\n\tprotected _afterTextSave(_dataContext: any) {\r\n\r\n\t}\r\n\r\n\tprotected _getLabelTemplate(): Template<any> {\r\n\t\tconst template: any = {};\r\n\r\n\t\tconst labelFontSize = this.get(\"labelFontSize\");\r\n\t\tif (labelFontSize != null) {\r\n\t\t\ttemplate.fontSize = labelFontSize;\r\n\t\t}\r\n\r\n\t\tconst labelFontFamily = this.get(\"labelFontFamily\");\r\n\t\tif (labelFontFamily != null) {\r\n\t\t\ttemplate.fontFamily = labelFontFamily;\r\n\t\t}\r\n\r\n\t\tconst labelFontWeight = this.get(\"labelFontWeight\");\r\n\t\tif (labelFontWeight != null) {\r\n\t\t\ttemplate.fontWeight = labelFontWeight;\r\n\t\t}\r\n\r\n\t\tconst labelFontStyle = this.get(\"labelFontStyle\");\r\n\t\tif (labelFontStyle != null) {\r\n\t\t\ttemplate.fontStyle = labelFontStyle;\r\n\t\t}\r\n\r\n\t\tconst labelFill = this.get(\"labelFill\");\r\n\t\tif (labelFill != null) {\r\n\t\t\ttemplate.fill = labelFill;\r\n\t\t}\r\n\r\n\t\treturn Template.new(template);\r\n\t}\r\n\r\n\tpublic disposeDataItem(dataItem: DataItem<this[\"_dataItemSettings\"]>) {\r\n\t\tsuper.disposeDataItem(dataItem);\r\n\t\tthis.spriteResizer.set(\"sprite\", undefined);\r\n\t\tthis._isHover = false;\r\n\t}\r\n\r\n\tprotected _hideAllBullets() {\r\n\r\n\t}\r\n\r\n\tprotected _updateSelector(selector: Graphics, index: number) {\r\n\t\tconst context = this._getContext(index);\r\n\t\tif (context) {\r\n\t\t\tconst sprite = context.sprite;\r\n\r\n\t\t\tif (sprite) {\r\n\t\t\t\tif (sprite.dataItem == this.spriteResizer.get(\"sprite\")?.dataItem) {\r\n\t\t\t\t\tselector.hide(0);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (this._selected.indexOf(index) != -1) {\r\n\t\t\t\t\t\tselector.show(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst selectorPadding = this.get(\"selectorPadding\", 5);\r\n\r\n\t\t\t\tlet bounds = sprite.bounds();\r\n\r\n\t\t\t\tlet w = (bounds.right - bounds.left) + selectorPadding * 2;\r\n\t\t\t\tlet h = (bounds.bottom - bounds.top) + selectorPadding * 2;\r\n\r\n\t\t\t\tselector.setAll({\r\n\t\t\t\t\twidth: w,\r\n\t\t\t\t\theight: h,\r\n\t\t\t\t\tx: bounds.left - selectorPadding,\r\n\t\t\t\t\ty: bounds.top - selectorPadding\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic _prepareChildren() {\r\n\t\tsuper._prepareChildren();\r\n\t\tif (this.isDirty(\"labelFontSize\") || this.isDirty(\"labelFontFamily\") || this.isDirty(\"labelFontWeight\") || this.isDirty(\"labelFontStyle\") || this.isDirty(\"labelFill\")) {\r\n\t\t\t$array.each(this._selected, (i) => {\r\n\t\t\t\tthis._applySettings(i);\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _applySettings(index: number, _settings?: { [index: string]: any }) {\r\n\t\tlet context = this._getContext(index);\r\n\r\n\t\tif (context) {\r\n\t\t\tlet label = context.label;\r\n\r\n\t\t\tif (label) {\r\n\t\t\t\tlet template = context.settings;\r\n\r\n\t\t\t\tconst labelSettings = {\r\n\t\t\t\t\tfontSize: this.get(\"labelFontSize\"),\r\n\t\t\t\t\tfontFamily: this.get(\"labelFontFamily\"),\r\n\t\t\t\t\tfontWeight: this.get(\"labelFontWeight\"),\r\n\t\t\t\t\tfontStyle: this.get(\"labelFontStyle\"),\r\n\t\t\t\t\tfill: this.get(\"labelFill\"),\r\n\t\t\t\t\tfillColor: this.get(\"fillColor\")\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst defaultState = label.states.lookup(\"default\")!;\r\n\t\t\t\tif (labelSettings) {\r\n\t\t\t\t\t$object.each(labelSettings, (key, value) => {\r\n\t\t\t\t\t\tlabel.set(key as any, value);\r\n\t\t\t\t\t\tdefaultState.set(key as any, value);\r\n\t\t\t\t\t\tif (template) {\r\n\t\t\t\t\t\t\ttemplate.set(key, value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _handleBulletDragStart(event: ISpritePointerEvent) {\r\n\t\t// don't call super\t\t\r\n\t\tconst stockChart = this._getStockChart();\r\n\t\tif (stockChart) {\r\n\t\t\tstockChart._dragStartDrawing(event);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _handleBulletDragStop(event: ISpritePointerEvent) {\r\n\t\tconst stockChart = this._getStockChart();\r\n\t\tif (stockChart) {\r\n\t\t\tstockChart._dragStopDrawing(event);\r\n\t\t}\r\n\r\n\t\tthis._root.events.once(\"frameended\", () => {\r\n\t\t\tthis._positionBullets(event.target.dataItem as DataItem<IDrawingSeriesDataItem>);\r\n\t\t})\r\n\t}\r\n}"]}